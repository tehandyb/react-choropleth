{"version":3,"file":"choropleth-dist.js","sources":["../src/choropleth.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport * as d3Scale from 'd3-scale'\nimport * as d3Geo from 'd3-geo'\nimport './defaultStyles.css'\n\nfunction dataValueAccessor(featureId, data) {\n  const datum = data.find(d => d.featureId === featureId)\n  if(datum === undefined) return undefined\n  return datum.value\n}\n\nfunction shapes(features, pathGenerator, colorScale, data, dataValueAccessor) {\n  return features.map(feature => (\n    <path key={feature.id} d={pathGenerator(feature)} fill={colorScale(dataValueAccessor(feature.id, data), data)} />\n  ))\n}\n\nfunction transform(geoJson, width, height, pathGenerator) {\n  const bounds = pathGenerator.bounds(geoJson)\n  const dx = bounds[1][0] - bounds[0][0]\n  const dy = bounds[1][1] - bounds[0][1]\n  const x = (bounds[0][0] + bounds[1][0]) / 2\n  const y = (bounds[0][1] + bounds[1][1]) / 2\n  const scale = 0.9 / Math.max(dx / width, dy / height)\n  const translate = [(width / 2) - (scale * x), (height / 2) - (scale * y)]\n\n  return { scale, translate }\n}\n\nfunction colorScaleGenerator(colors, noDataColor) {\n  const scale = d3Scale.scaleLinear().range(colors)\n\n  return function(value, data) {\n    if(value === undefined) return noDataColor\n    const values = data.map(d => d.value)\n    scale.domain([Math.min(...values), Math.max(...values)])\n    return scale(value)\n  }\n}\n\nexport default function Choropleth ({ width, height, data, geoJson, colors, noDataColor, dataValueAccessor }) {\n  const projection = d3Geo.geoMercator()\n  const pathGenerator = d3Geo.geoPath(projection)\n  const colorScale = colorScaleGenerator(colors, noDataColor)\n  const { translate, scale } = transform(geoJson, width, height, pathGenerator)\n  return (\n    <svg className=\"react-choropleth\" width={width} height={height}>\n      <g transform={`translate(${translate})scale(${scale})`}>\n        {shapes(geoJson.features, pathGenerator, colorScale, data, dataValueAccessor)}\n      </g>\n    </svg>\n  )\n}\n\nChoropleth.propTypes = {\n  width: PropTypes.number,\n  height: PropTypes.number,\n  data: PropTypes.arrayOf(PropTypes.shape({\n    featureId: PropTypes.string,\n    value: PropTypes.number\n  })),\n  geoJson: PropTypes.shape({\n    features: PropTypes.arrayOf(PropTypes.shape({\n      id: PropTypes.string\n    }))\n  }),\n  dataValueAccessor: PropTypes.func\n}\n\nChoropleth.defaultProps = {\n  dataValueAccessor: dataValueAccessor\n}\n"],"names":["dataValueAccessor","featureId","data","datum","find","d","undefined","value","shapes","features","pathGenerator","colorScale","map","feature","id","transform","geoJson","width","height","bounds","dx","dy","x","y","scale","Math","max","translate","colorScaleGenerator","colors","noDataColor","d3Scale","range","values","domain","min","Choropleth","projection","d3Geo","propTypes","PropTypes","number","arrayOf","shape","string","func","defaultProps"],"mappings":"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"}